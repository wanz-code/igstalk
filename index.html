<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Instagram Stalker ‚Äî Wanz Official</title>
  <meta name="description" content="Instagram Stalker by Wanz Official" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --ig1:#f58529; --ig2:#dd2a7b; --ig3:#8134af; --ig4:#515bd4;
      --text:#101827; --muted:#6b7280; --card:rgba(255,255,255,.9);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
      background:
        radial-gradient(1200px 600px at 10% 10%, rgba(245,133,41,.12), transparent 60%),
        radial-gradient(1000px 500px at 90% 10%, rgba(254,218,117,.12), transparent 60%),
        radial-gradient(1000px 500px at 0% 100%, rgba(193,53,132,.12), transparent 60%),
        radial-gradient(900px 450px at 100% 100%, rgba(131,58,180,.12), transparent 60%),
        linear-gradient(135deg,#0b1220,#05080f 60%,#03060b);
      color:#f8fafc;
      display:flex; align-items:flex-start; justify-content:center; padding:32px 16px;
    }
    .wrap{width:100%; max-width:880px}
    header{
      display:flex; align-items:center; gap:12px; margin-bottom:18px;
    }
    .logo{width:44px; height:44px; border-radius:12px;
      background: conic-gradient(from 210deg,var(--ig1),var(--ig2),var(--ig3),var(--ig4),var(--ig1));
      display:grid; place-items:center; color:white; font-weight:700;
      box-shadow:0 10px 30px rgba(0,0,0,.35);
    }
    h1{margin:0; font-size:28px; line-height:1.2}
    .subtitle{margin:0; font-size:12px; color:#cbd5e1}

    .card{
      background:var(--card);
      color:var(--text);
      border-radius:20px;
      border:1px solid rgba(255,255,255,.16);
      box-shadow:0 18px 60px rgba(3,6,11,.35);
    }
    .glass{backdrop-filter:blur(16px); -webkit-backdrop-filter:blur(16px)}
    .pad{padding:18px}
    .grid{display:grid; gap:12px}
    .search{
      display:grid; grid-template-columns:1fr auto; gap:10px; align-items:center;
      background:rgba(3,6,11,.35); border:1px solid rgba(255,255,255,.14);
      border-radius:16px; padding:10px; color:#e5e7eb;
    }
    .search input{
      border:none; outline:none; background:transparent; color:#fff;
      padding:10px 12px; font-size:15px;
    }
    .btn{
      border:none; cursor:pointer; padding:12px 18px; border-radius:14px; font-weight:700; color:#fff;
      background:linear-gradient(45deg,var(--ig1),var(--ig2),var(--ig3),var(--ig4));
      background-size:250% 250%; transition:transform .15s ease, filter .15s ease, background-position 8s ease;
    }
    .btn:hover{filter:saturate(1.1)}
    .btn:disabled{opacity:.6; cursor:not-allowed}
    .btn .spinner{display:none; width:18px; height:18px; border-radius:50%; border:3px solid #fff; border-right-color:transparent; animation:spin 1s linear infinite}
    .btn.loading .text{display:none}
    .btn.loading .spinner{display:inline-block}
    @keyframes spin{to{transform:rotate(360deg)}}

    .result{margin-top:14px}
    .section{padding:16px 18px; border-top:1px dashed rgba(3,6,11,.09)}
    .section:first-child{border-top:none}
    .section h3{margin:0 0 10px 0; font-size:15px; color:#0f172a}
    .muted{color:var(--muted)}
    .stats{display:grid; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); gap:10px}
    .stat{background:#ffffff; border:1px solid #e5e7eb; border-radius:14px; padding:12px}
    .stat .label{font-size:12px; color:#6b7280}
    .stat .val{font-weight:700; font-size:18px}

    .chips{display:flex; flex-wrap:wrap; gap:8px}
    .chip{font-size:12px; padding:6px 10px; border-radius:999px; color:#fff;
      background:linear-gradient(45deg,var(--ig3),var(--ig2));}

    .post{display:flex; align-items:center; justify-content:space-between; gap:10px; background:#fff; border:1px solid #e5e7eb; border-radius:14px; padding:12px}
    .post .meta{display:flex; gap:10px; align-items:center; color:#111827; font-weight:600}
    .link{color:#2563eb; text-decoration:none}
    .wm{margin-top:14px; text-align:center; color:#cbd5e1; font-size:12px}
    .fade-in{animation:fade .35s ease-out both}
    @keyframes fade{from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:none}}

    /* toast */
    .toast-wrap{position:fixed; right:14px; bottom:14px; z-index:60; display:flex; flex-direction:column; gap:8px}
    .toast{background:#0b1220; color:#e5e7eb; border:1px solid #334155; padding:12px 14px; border-radius:14px; min-width:240px; box-shadow:0 10px 20px rgba(3,6,11,.35)}
    .toast-enter{opacity:0; transform:translateY(8px) scale(.98)}
    .toast-enter-active{opacity:1; transform:none; transition:all .22s ease-out}
  </style>
</head>
<body>
  <div class="wrap">
    <header class="fade-in">
      <div class="logo" aria-hidden="true">IG</div>
      <div>
        <h1>Instagram Stalker</h1>
        <p class="subtitle">Cari statistik profil & postingan populer ‚Äî data mengikuti respons API</p>
      </div>
    </header>

    <!-- Kartu Pencarian -->
    <div class="card glass pad fade-in">
      <div class="grid">
        <label for="username" class="muted" style="font-size:12px">Username Instagram (tanpa @)</label>
        <div class="search">
          <input id="username" type="text" placeholder="cth: trindsess" autocomplete="off" />
          <button id="searchBtn" class="btn"><span class="text">Cari</span><span class="spinner" aria-hidden="true"></span></button>
        </div>
      </div>

      <!-- Hasil -->
      <div id="result" class="result" aria-live="polite"></div>
    </div>

    <p class="wm">¬© Wanz Official</p>
  </div>

  <!-- Toast -->
  <div class="toast-wrap" id="toasts"></div>

  <script>
    const $ = (sel)=>document.querySelector(sel);
    const el = {
      username: $('#username'),
      search: $('#searchBtn'),
      result: $('#result'),
      toasts: $('#toasts')
    };

    function toast(msg){
      const t = document.createElement('div');
      t.className = 'toast toast-enter';
      t.textContent = msg;
      el.toasts.appendChild(t);
      requestAnimationFrame(()=>t.classList.add('toast-enter-active'));
      setTimeout(()=>{ t.remove(); }, 2800);
    }

    function lockButton(lock){
      if(lock){
        el.search.classList.add('loading');
        el.search.disabled = true;
      } else {
        el.search.classList.remove('loading');
        el.search.disabled = false;
      }
    }

    function section(title, inner){
      return `
        <div class="section">
          <h3>${title}</h3>
          ${inner}
        </div>
      `;
    }

    function render(data){
      // data mengikuti struktur: { status, content, result:{ ...fields } }
      const r = data?.result || {};

      // Helper aman untuk nilai kosong
      const val = (x, fallback='-') => (x===undefined || x===null || x==='') ? fallback : x;

      // Bagian ringkas utama
      const top =
        `<div class="section">
          <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap">
            <div>
              <div style="font-size:22px; font-weight:700">@${val(r.name)}</div>
              <div class="muted" style="margin-top:4px; white-space:pre-line">${val(r.description)}</div>
            </div>
            <div style="width:64px; height:64px; border-radius:16px; background:linear-gradient(45deg,var(--ig1),var(--ig2),var(--ig3)); display:grid; place-items:center; color:#fff; font-weight:700">IG</div>
          </div>
        </div>`;

      // Statistik angka
      const stats =
        `<div class="stats">
          <div class="stat"><div class="label">Pengikut</div><div class="val">${val(r.followers)}</div></div>
          <div class="stat"><div class="label">Unggahan</div><div class="val">${val(r.uploads)}</div></div>
          <div class="stat"><div class="label">Engagement Rate</div><div class="val">${val(r.engagementRate)}</div></div>
        </div>`;

      // Aktivitas posting
      const activity =
        `<div class="stats">
          <div class="stat"><div class="label">Aktivitas Rata-rata</div><div class="val">${val(r.averageActivity)}</div></div>
          <div class="stat"><div class="label">Post per Hari</div><div class="val">${val(r.postsPerDay)}</div></div>
          <div class="stat"><div class="label">Post per Minggu</div><div class="val">${val(r.postsPerWeek)}</div></div>
          <div class="stat"><div class="label">Post per Bulan</div><div class="val">${val(r.postsPerMonth)}</div></div>
          <div class="stat"><div class="label">Jumlah Post (rasio)</div><div class="val">${val(r.amountOfPosts)}</div></div>
          <div class="stat"><div class="label">Waktu Populer</div><div class="val">${val(r.mostPopularPostTime)}</div></div>
        </div>`;

      // Hashtags
      const tags = (Array.isArray(r.hashtags) ? r.hashtags : []).map(h=>`<span class="chip">${h}</span>`).join('') || '<span class="muted">-</span>';

      // Postingan Like & Komentar Terpopuler
      const liked = (Array.isArray(r.mostLikedPosts)?r.mostLikedPosts:[]).map(p => `
        <div class="post">
          <div class="meta">‚ù§Ô∏è ${val(p.likes)} &nbsp;‚Ä¢&nbsp; üí¨ ${val(p.comments)}</div>
          <a class="link" href="${p.link}" target="_blank" rel="noopener">Buka</a>
        </div>`).join('') || '<div class="muted">Tidak ada data.</div>';

      const commented = (Array.isArray(r.mostCommentedPosts)?r.mostCommentedPosts:[]).map(p => `
        <div class="post">
          <div class="meta">üí¨ ${val(p.comments)} &nbsp;‚Ä¢&nbsp; ‚ù§Ô∏è ${val(p.likes)}</div>
          <a class="link" href="${p.link}" target="_blank" rel="noopener">Buka</a>
        </div>`).join('') || '<div class="muted">Tidak ada data.</div>';

      el.result.innerHTML =
        top +
        section('Ringkasan', stats) +
        section('Aktivitas', activity) +
        section('Hashtag', `<div class="chips">${tags}</div>`) +
        section('Postingan Paling Disukai', liked) +
        section('Postingan Paling Banyak Komentar', commented);

      el.result.parentElement.classList.add('fade-in');
    }

    async function run(){
      const username = el.username.value.trim().replace(/^@/,'');
      if(!username){ toast('Masukkan username terlebih dahulu.'); return; }

      lockButton(true);
      el.result.innerHTML = '';
      try{
        const res = await fetch(`/api/stalk?username=${encodeURIComponent(username)}`, { cache:'no-store' });
        const json = await res.json();

        if(!res.ok){
          toast(`Gagal (${res.status}).`);
          return;
        }
        if(json?.status !== 200 || !json?.result){
          toast(json?.content || 'Data tidak ditemukan.');
          return;
        }
        render(json);
      }catch(e){
        toast('Terjadi kesalahan koneksi.');
      }finally{
        lockButton(false);
      }
    }

    el.search.addEventListener('click', run);
    el.username.addEventListener('keydown', e=>{ if(e.key==='Enter') run(); });
  </script>
</body>
</html>